
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{Homework 1}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    This is the first homework of Guanzhuo Qiao in FE-621 class. The data is
analyzed by Pyhton and the report is produced by Jupyter.

    \section{Part 1}\label{part-1}

\subsection{}\label{section}

    Download data from Yahoo finance using the ``pandas\_datareader''
package in python. In order to download the data, I write a function to
download every stock's equity data and options data in a given list and
save them into a local direction.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
         \PY{k+kn}{from} \PY{n+nn}{pandas\PYZus{}datareader} \PY{k}{import} \PY{n}{data} \PY{k}{as} \PY{n}{pdrd}
         \PY{k+kn}{import} \PY{n+nn}{pandas\PYZus{}datareader}\PY{n+nn}{.}\PY{n+nn}{yahoo}\PY{n+nn}{.}\PY{n+nn}{options} \PY{k}{as} \PY{n+nn}{pdro}
         \PY{k+kn}{import} \PY{n+nn}{datetime} \PY{k}{as} \PY{n+nn}{dt}
         \PY{k+kn}{import} \PY{n+nn}{math} \PY{k}{as} \PY{n+nn}{m}
         \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
         \PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k}{import} \PY{n}{norm}
         \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt} 
         \PY{k+kn}{import} \PY{n+nn}{time}
         \PY{k+kn}{import} \PY{n+nn}{os}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{n}{os}\PY{o}{.}\PY{n}{chdir}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{D:}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s+s1}{Grad 2}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s+s1}{621}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s+s1}{assignment}\PY{l+s+se}{\PYZbs{}\PYZbs{}}\PY{l+s+s1}{data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{k}{def} \PY{n+nf}{download}\PY{p}{(}\PY{n}{stocklist}\PY{p}{)}\PY{p}{:}
             \PY{n}{starttime} \PY{o}{=} \PY{n}{dt}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2018}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{endtime} \PY{o}{=} \PY{n}{dt}\PY{o}{.}\PY{n}{date}\PY{o}{.}\PY{n}{today}\PY{p}{(}\PY{p}{)}
             \PY{k}{for} \PY{n}{stock} \PY{o+ow}{in} \PY{n}{stocklist}\PY{p}{:}
                 \PY{n}{equity\PYZus{}data} \PY{o}{=} \PY{n}{pdrd}\PY{o}{.}\PY{n}{DataReader}\PY{p}{(}\PY{n}{stock}\PY{p}{,} \PY{n}{data\PYZus{}source}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{yahoo}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                               \PY{n}{start}\PY{o}{=}\PY{n}{starttime}\PY{p}{,}\PY{n}{end}\PY{o}{=}\PY{n}{endtime}\PY{p}{)}
                 \PY{n}{equity\PYZus{}data}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{.}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ equity.csv}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{endtime}\PY{o}{.}\PY{n}{month}\PY{p}{,}
                                                                 \PY{n}{endtime}\PY{o}{.}\PY{n}{day}\PY{p}{,}\PY{n}{stock}\PY{p}{)}\PY{p}{)}
                 \PY{n}{option\PYZus{}name} \PY{o}{=} \PY{n}{pdro}\PY{o}{.}\PY{n}{Options}\PY{p}{(}\PY{n}{stock}\PY{p}{)}
                 \PY{n}{option\PYZus{}data} \PY{o}{=} \PY{n}{option\PYZus{}name}\PY{o}{.}\PY{n}{get\PYZus{}forward\PYZus{}data}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{n}{call}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}\PY{n}{put}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                 \PY{n}{option\PYZus{}data}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{.}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{endtime}\PY{o}{.}\PY{n}{month}\PY{p}{,}\PY{n}{endtime}\PY{o}{.}\PY{n}{day}\PY{p}{,}
                                                                 \PY{n}{stock}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    This function can download the equity data from 2018-01-01 to the
caurrent date and save them separately into a file.

\textbf{\emph{Bonus}}

Create another function so that it can not only download but also
combine all those data and save them.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}26}]:} \PY{k}{def} \PY{n+nf}{download\PYZus{}combine\PYZus{}equity}\PY{p}{(}\PY{n}{stocklist}\PY{p}{,}\PY{n}{stock\PYZus{}startt}\PY{p}{,} \PY{n}{stock\PYZus{}endt}\PY{p}{)}\PY{p}{:}
             \PY{n}{equitylist} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{k}{for} \PY{n}{stock} \PY{o+ow}{in} \PY{n}{stocklist}\PY{p}{:}
                 \PY{n}{equitylist}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pdrd}\PY{o}{.}\PY{n}{DataReader}\PY{p}{(}\PY{n}{stock}\PY{p}{,} \PY{n}{data\PYZus{}source}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{yahoo}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                                   \PY{n}{start}\PY{o}{=}\PY{n}{stock\PYZus{}startt}\PY{p}{,}\PY{n}{end}\PY{o}{=}\PY{n}{stock\PYZus{}endt}\PY{p}{)}\PY{p}{)}
             \PY{n}{equitydata} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{equitylist}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{n}{equitylist}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}\PY{n}{how}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{inner}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                   \PY{n}{left\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}\PY{n}{right\PYZus{}index} \PY{o}{=} \PY{k+kc}{True}\PY{p}{,}
                                   \PY{n}{suffixes}\PY{o}{=}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{+}\PY{n}{stocklist}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{+}\PY{n}{stocklist}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}
             \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{n+nb}{len}\PY{p}{(}\PY{n}{equitylist}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                 \PY{n}{equitylist}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{n}{name}\PY{o}{+}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{+}\PY{n}{stocklist}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{k}{for} \PY{n}{name} \PY{o+ow}{in} \PY{n}{equitylist}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{]}
                 \PY{n}{equitydata} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{equitydata}\PY{p}{,}\PY{n}{equitylist}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{n}{how}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{inner}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                       \PY{n}{left\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}\PY{n}{right\PYZus{}index} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
             \PY{n}{equitydata}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{combined equity data.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{k}{def} \PY{n+nf}{combine\PYZus{}options}\PY{p}{(}\PY{n}{options\PYZus{}file\PYZus{}list}\PY{p}{)}\PY{p}{:}
             \PY{n}{optionslist}\PY{o}{=}\PY{p}{[}\PY{p}{]}
             \PY{n}{Download\PYZus{}Date} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{k}{for} \PY{n}{file\PYZus{}name} \PY{o+ow}{in} \PY{n}{options\PYZus{}file\PYZus{}list}\PY{p}{:}
                 \PY{n}{Download\PYZus{}Date}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{file\PYZus{}name}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
                 \PY{n}{optionslist}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{file\PYZus{}name}\PY{p}{)}\PY{p}{)}
                 \PY{n}{optionslist}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Download\PYZus{}Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{=}\PY{n}{Download\PYZus{}Date}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n}{optionsdata} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{concat}\PY{p}{(}\PY{n}{optionslist}\PY{p}{,}\PY{n}{ignore\PYZus{}index}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}\PY{p}{)}
             \PY{n}{optionsdata} \PY{o}{=} \PY{n}{optionsdata}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Download\PYZus{}Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{+}\PYZbs{}
                         \PY{n+nb}{list}\PY{p}{(}\PY{n}{optionsdata}\PY{o}{.}\PY{n}{columns}\PY{p}{[}\PY{n}{optionsdata}\PY{o}{.}\PY{n}{columns} \PY{o}{!=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Download\PYZus{}Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{]}
             \PY{n}{optionsdata}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{combined options data.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    The first function \emph{download\_combin\_equity()} is created to
download and combine the equity data for a given time period.

The second function \emph{combine\_options()} is for reading and
combning the saved options \emph{.csv} files. The combination is based
on the date in which they are downloaded. Here I use the previously
downloaded options data files to show the catual performance.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}27}]:} \PY{n}{download\PYZus{}combine\PYZus{}equity}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{amzn}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{spy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZca{}vix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{aapl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}01\PYZhy{}01}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}03\PYZhy{}01}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{combine\PYZus{}options}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.11 amzn option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.11 spy option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.11 \PYZca{}vix option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.12 amzn option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.12 spy option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.12 \PYZca{}vix option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}28}]:} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{combined equity data.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}28}]:}          Date    High\_amzn     Low\_amzn    Open\_amzn   Close\_amzn  \textbackslash{}
         0  2019-01-02  1553.359985  1460.930054  1465.199951  1539.130005   
         1  2019-01-03  1538.000000  1497.109985  1520.010010  1500.280029   
         2  2019-01-04  1594.000000  1518.310059  1530.000000  1575.390015   
         3  2019-01-07  1634.560059  1589.189941  1602.310059  1629.510010   
         4  2019-01-08  1676.609985  1616.609985  1664.689941  1656.579956   
         
            Volume\_amzn  Adj Close\_amzn    High\_spy     Low\_spy    Open\_spy  \textbackslash{}
         0      7983100     1539.130005  251.210007  245.949997  245.979996   
         1      6975600     1500.280029  248.570007  243.669998  248.229996   
         2      9182600     1575.390015  253.110001  247.169998  247.589996   
         3      7993200     1629.510010  255.949997  251.690002  252.690002   
         4      8881400     1656.579956  257.309998  254.000000  256.820007   
         
                 {\ldots}        Open\_\^{}vix  Close\_\^{}vix  Volume\_\^{}vix  Adj Close\_\^{}vix  \textbackslash{}
         0       {\ldots}        27.540001   23.219999            0       23.219999   
         1       {\ldots}        25.680000   25.450001            0       25.450001   
         2       {\ldots}        24.360001   21.379999            0       21.379999   
         3       {\ldots}        22.059999   21.400000            0       21.400000   
         4       {\ldots}        20.959999   20.469999            0       20.469999   
         
             High\_aapl    Low\_aapl   Open\_aapl  Close\_aapl  Volume\_aapl  Adj Close\_aapl  
         0  158.850006  154.229996  154.889999  157.919998   37039700.0      157.245605  
         1  145.720001  142.000000  143.979996  142.190002   91312200.0      141.582779  
         2  148.550003  143.800003  144.529999  148.259995   58607100.0      147.626846  
         3  148.830002  145.899994  148.699997  147.929993   54777800.0      147.298264  
         4  151.820007  148.520004  149.559998  150.750000   41025300.0      150.106216  
         
         [5 rows x 25 columns]
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}29}]:} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{combined options data.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}29}]:}    Unnamed: 0  Download\_Date  Strike      Expiry  Type               Symbol  \textbackslash{}
         0           0           2.11   690.0  2019-02-15   put  AMZN190215P00690000   
         1           1           2.11   710.0  2019-02-15  call  AMZN190215C00710000   
         2           2           2.11   750.0  2019-04-18   put  AMZN190418P00750000   
         3           3           2.11   760.0  2019-03-15  call  AMZN190315C00760000   
         4           4           2.11   760.0  2019-03-15   put  AMZN190315P00760000   
         
              Last     Bid     Ask  Chg  \textbackslash{}
         0    0.02    0.00    0.05  0.0   
         1  928.14  881.25  888.45  0.0   
         2    0.26    0.00    0.30  0.0   
         3  881.00  834.15  844.00  0.0   
         4    0.03    0.00    0.04  0.0   
         
                                  {\ldots}                           Vol  Open\_Int  \textbackslash{}
         0                        {\ldots}                           8.0      64.0   
         1                        {\ldots}                          10.0      10.0   
         2                        {\ldots}                          10.0     254.0   
         3                        {\ldots}                          10.0       7.0   
         4                        {\ldots}                          20.0     369.0   
         
                  IV  Root IsNonstandard  Underlying Underlying\_Price  \textbackslash{}
         0  2.117192  AMZN         False        AMZN          1591.13   
         1  3.467531  AMZN         False        AMZN          1591.13   
         2  0.604496  AMZN         False        AMZN          1591.13   
         3  1.423648  AMZN         False        AMZN          1591.13   
         4  0.718753  AMZN         False        AMZN          1591.13   
         
                     Quote\_Time      Last\_Trade\_Date  \textbackslash{}
         0  2019-02-11 15:31:05  2019-01-25 18:35:43   
         1  2019-02-11 15:31:05  2019-01-19 04:49:48   
         2  2019-02-11 15:31:05  2019-02-08 16:00:49   
         3  2019-02-11 15:31:05  2019-01-30 14:49:01   
         4  2019-02-11 15:31:05  2019-02-07 15:39:23   
         
                                                         JSON  
         0  \{'contractSymbol': 'AMZN190215P00690000', 'str{\ldots}  
         1  \{'contractSymbol': 'AMZN190215C00710000', 'str{\ldots}  
         2  \{'contractSymbol': 'AMZN190418P00750000', 'str{\ldots}  
         3  \{'contractSymbol': 'AMZN190315C00760000', 'str{\ldots}  
         4  \{'contractSymbol': 'AMZN190315P00760000', 'str{\ldots}  
         
         [5 rows x 21 columns]
\end{Verbatim}
            
    \subsection{}\label{section}

We should run the previous download function for two consecutive days.
Then let's read the data into the program and do the combination and
clean them. Here we apply the multi-index so that we can easily find the
specific data that we need in the following questions.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{c+c1}{\PYZsh{}download([\PYZsq{}amzn\PYZsq{},\PYZsq{}spy\PYZsq{},\PYZsq{}\PYZca{}vix\PYZsq{}])}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{c+c1}{\PYZsh{}read the data}
         \PY{n}{AMZN\PYZus{}option1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.11 amzn option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{SPY\PYZus{}option1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.11 spy option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{VIX\PYZus{}option1} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.11 \PYZca{}vix option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{AMZN\PYZus{}option2} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.12 amzn option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{SPY\PYZus{}option2} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.12 spy option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{VIX\PYZus{}option2} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2.12 \PYZca{}vix option.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{}create the data sets}
         \PY{n}{Data1} \PY{o}{=} \PY{n}{AMZN\PYZus{}option1}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{SPY\PYZus{}option1}\PY{p}{)}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{VIX\PYZus{}option1}\PY{p}{)}
         \PY{n}{Data1} \PY{o}{=} \PY{n}{Data1}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{Data1}\PY{o}{.}\PY{n}{index}\PY{p}{]}\PY{p}{)} \PY{c+c1}{\PYZsh{} set the multi\PYZhy{}index}
         \PY{n}{Data2} \PY{o}{=} \PY{n}{AMZN\PYZus{}option2}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{SPY\PYZus{}option2}\PY{p}{)}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{VIX\PYZus{}option2}\PY{p}{)}
         \PY{n}{Data2} \PY{o}{=} \PY{n}{Data2}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{Data2}\PY{o}{.}\PY{n}{index}\PY{p}{]}\PY{p}{)}
         \PY{k}{del} \PY{n}{AMZN\PYZus{}option1}\PY{p}{,}\PY{n}{SPY\PYZus{}option1} \PY{p}{,}\PY{n}{VIX\PYZus{}option1}\PY{p}{,}\PY{n}{AMZN\PYZus{}option2}\PY{p}{,}\PY{n}{SPY\PYZus{}option2} \PY{p}{,}\PY{n}{VIX\PYZus{}option2}
         
         \PY{c+c1}{\PYZsh{}clean the data}
         \PY{n}{Data1} \PY{o}{=} \PY{n}{Data1}\PY{o}{.}\PY{n}{drop\PYZus{}duplicates}\PY{p}{(}\PY{p}{)}
         \PY{n}{Data2} \PY{o}{=} \PY{n}{Data2}\PY{o}{.}\PY{n}{drop\PYZus{}duplicates}\PY{p}{(}\PY{p}{)}
         \PY{n}{Data1} \PY{o}{=} \PY{n}{Data1}\PY{p}{[}\PY{n}{Data1}\PY{o}{.}\PY{n}{notnull}\PY{p}{(}\PY{p}{)}\PY{p}{]}
         \PY{n}{Data2} \PY{o}{=} \PY{n}{Data2}\PY{p}{[}\PY{n}{Data2}\PY{o}{.}\PY{n}{notnull}\PY{p}{(}\PY{p}{)}\PY{p}{]}
         \PY{n}{Data1} \PY{o}{=} \PY{n}{Data1}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Last}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{n}{Data2} \PY{o}{=} \PY{n}{Data2}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Last}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
\end{Verbatim}


    \subsection{}\label{section}

The symbols used in this program are shown here:

\emph{S}: spot price, \emph{K}: strike price, \emph{P}: current option
price, \emph{T or TtM}: time to maturity, \emph{vol}: volatility,
\emph{Avr\_Price}: average price of the bid and ask, \emph{opt\_type}:
options type.

For the options symbol in the exchange, we have to explain the meaning
here. Take this one for example:

"AMZN190215P00690000" stand for the options with underlying of AMZN and
maturity date of 2019-02-15 and strike price of \$ 00690.000

SPY is stand for the SPDR S\&P 500 trust, an exchange-traded fund (ETF)
which trades on the NYSE Arca. And an ETF is an investment fund traded
on stock exchanges. It holds assets such as stocks, commodities, or
bonds and generally operates with an arbitrage mechanism designed to
keep it trading close to its net asset value. SPY is such a ETF that is
designed to track the S\&P 500 stock market index and it offers
investors a way to diversify their portfolio without having to buy hole
basket stocks.

The CBOE Volatility Index, known by its ticker symbol VIX, is a popular
measure of the stock market's expectation of volatility implied by S\&P
500 index options which have an average expiration of 30 days. It is
commonly referred to as the fear index. The index takes as inputs the
market prices of the call and put optionsand and risk-free U.S. treasury
bill interest rates.

In the data we have downloaded, the nearist maturity is 1 day and the
farest expiration date is at 2019-04-18 which is 66 days far from the
download date. The average expiration of the at-the-money options' data
we used in the following question is 27.23 days.

    \subsection{}\label{section}

The current rate of Fedral funds (effective) is 2.4\% annually. The
underlying stocks' price is recorded in the data we downloaded
previously, here we show the basic prices we'v got:

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{c+c1}{\PYZsh{} Set the basic asset prices}
         \PY{n}{rate}\PY{o}{=}\PY{l+m+mf}{2.4}\PY{o}{/}\PY{l+m+mi}{100}
         \PY{n}{asset\PYZus{}price} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rate}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{n}{rate}\PY{p}{,}\PY{n}{rate}\PY{p}{]}\PY{p}{,}
                                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{n}{Data1}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                  \PY{n}{Data2}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,}
                                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{n}{Data1}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                  \PY{n}{Data2}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,}
                                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VIX\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{p}{[}\PY{n}{Data1}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZca{}VIX}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                  \PY{n}{Data2}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZca{}VIX}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{,}
                                     \PY{n}{index} \PY{o}{=} \PY{p}{[}\PY{n}{dt}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2019}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{11}\PY{p}{)}\PY{p}{,}\PY{n}{dt}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2019}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{12}\PY{p}{)}\PY{p}{]}\PY{p}{)}
         \PY{n}{asset\PYZus{}price}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{names}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{asset\PYZus{}price}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{asset price.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{asset price.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}19}]:}          Date   rate  AMZN\_price  SPY\_price  VIX\_price
         0  2019-02-11  0.024     1591.13     270.49      16.27
         1  2019-02-12  0.024     1629.09     273.80      15.44
\end{Verbatim}
            
    Now we need to get the time to maturity, we convert the form to the
annual form.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{n}{current\PYZus{}date} \PY{o}{=} \PY{n}{dt}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2019}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{11}\PY{p}{)}
         \PY{n}{Data1}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{=}  \PY{p}{[}\PY{n}{dt}\PY{o}{.}\PY{n}{datetime}\PY{o}{.}\PY{n}{strptime}\PY{p}{(}\PY{n}{i}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{Y\PYZhy{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m\PYZhy{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{Data1}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{n}{Data1}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{current\PYZus{}date}\PY{p}{)}\PY{o}{.}\PY{n}{days}\PY{o}{/}\PY{l+m+mi}{365} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{Data1}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{n}{current\PYZus{}date} \PY{o}{=} \PY{n}{dt}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{l+m+mi}{2019}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{12}\PY{p}{)}
         \PY{n}{Data2}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{=}  \PY{p}{[}\PY{n}{dt}\PY{o}{.}\PY{n}{datetime}\PY{o}{.}\PY{n}{strptime}\PY{p}{(}\PY{n}{i}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{Y\PYZhy{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m\PYZhy{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{Data2}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{n}{Data2}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{[}\PY{p}{(}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{n}{current\PYZus{}date}\PY{p}{)}\PY{o}{.}\PY{n}{days}\PY{o}{/}\PY{l+m+mi}{365} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{Data2}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{k}{del} \PY{n}{current\PYZus{}date}
\end{Verbatim}


    \section{Part 2}\label{part-2}

    \subsection{}\label{section}

We define a function to calculate the option's price using Black-Scholes
formulas. The funciton's name is \emph{BS\_Formula()}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}24}]:} \PY{k}{def} \PY{n+nf}{BS\PYZus{}Formula}\PY{p}{(}\PY{n}{type\PYZus{}opt}\PY{p}{,} \PY{n}{r}\PY{p}{,} \PY{n}{vol}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{)}\PY{p}{:}
             \PY{n}{d\PYZus{}1} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{m}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{S}\PY{o}{/}\PY{n}{K}\PY{p}{)}\PY{o}{+}\PY{p}{(}\PY{n}{r}\PY{o}{+}\PY{n}{vol}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{n}{T}\PY{p}{)}\PY{o}{/}\PY{n+nb}{float}\PY{p}{(}\PY{n}{vol}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{)}
             \PY{n}{d\PYZus{}2} \PY{o}{=} \PY{n}{d\PYZus{}1}\PY{o}{\PYZhy{}}\PY{n}{vol}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{T}\PY{p}{)}
             \PY{k}{if} \PY{n}{type\PYZus{}opt} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                 \PY{k}{return} \PY{n}{norm}\PY{o}{.}\PY{n}{cdf}\PY{p}{(}\PY{n}{d\PYZus{}1}\PY{p}{)}\PY{o}{*}\PY{n}{S}\PY{o}{\PYZhy{}}\PY{n}{K}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{n}{T}\PY{p}{)}\PY{o}{*}\PY{n}{norm}\PY{o}{.}\PY{n}{cdf}\PY{p}{(}\PY{n}{d\PYZus{}2}\PY{p}{)}
             \PY{k}{else}\PY{p}{:}
                 \PY{k}{return} \PY{n}{K}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{n}{T}\PY{p}{)}\PY{o}{*}\PY{n}{norm}\PY{o}{.}\PY{n}{cdf}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{d\PYZus{}2}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{norm}\PY{o}{.}\PY{n}{cdf}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{d\PYZus{}1}\PY{p}{)}\PY{o}{*}\PY{n}{S}
\end{Verbatim}


    \subsection{}\label{section}

\textbf{\emph{Implement the Bisection method to find the root of
arbitrary functions. Apply this method to calculate the implied
volatility on the first day ...}}

First of all, we need to define the biseciton method and define another
function that gives us the average price of bid and ask.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}25}]:} \PY{k}{def} \PY{n+nf}{Bisection}\PY{p}{(}\PY{n}{func}\PY{p}{,}\PY{n}{tolerance}\PY{p}{,}\PY{n}{up}\PY{p}{,}\PY{n}{down}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{}if the initail guesses are at the same side then return nan  }
             \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{sign}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{down}\PY{p}{)}\PY{p}{)} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sign}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{up}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:} 
                 \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{nan}
             \PY{c+c1}{\PYZsh{}if the initail guesses fit the condition then they are the roots}
             \PY{k}{if} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{up}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{n}{tolerance}\PY{p}{:}
                 \PY{k}{return} \PY{n}{up}
             \PY{k}{if} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{down}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{n}{tolerance}\PY{p}{:}
                 \PY{k}{return} \PY{n}{down}
             \PY{n}{mid} \PY{o}{=} \PY{p}{(}\PY{n}{down} \PY{o}{+} \PY{n}{up}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{2}
             \PY{k}{while} \PY{p}{(} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{mid}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZgt{}} \PY{n}{tolerance} \PY{p}{)}\PY{p}{:}
                 \PY{k}{if} \PY{p}{(} \PY{n}{np}\PY{o}{.}\PY{n}{sign}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{down}\PY{p}{)}\PY{p}{)} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sign}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{mid}\PY{p}{)}\PY{p}{)} \PY{o}{\PYZlt{}} \PY{l+m+mi}{0} \PY{p}{)}\PY{p}{:}
                     \PY{n}{up} \PY{o}{=} \PY{n}{mid}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{down} \PY{o}{=} \PY{n}{mid}
                 \PY{n}{mid} \PY{o}{=} \PY{p}{(}\PY{n}{down} \PY{o}{+} \PY{n}{up}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{2}
             \PY{k}{return} \PY{n}{mid}
         \PY{c+c1}{\PYZsh{} do the average}
         \PY{k}{def} \PY{n+nf}{get\PYZus{}avrprice}\PY{p}{(}\PY{n}{bid}\PY{p}{,}\PY{n}{ask}\PY{p}{)}\PY{p}{:}
             \PY{k}{return} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{p}{(}\PY{n}{bid}\PY{o}{+}\PY{n}{ask}\PY{p}{)}
\end{Verbatim}


    Notice that in the biseciton method, when the initial guess interval
doesn't have the root, this method will give NaN as a return.

The second step is to select the data that we can use for this quesiton.
we need such a data set that the option's volumn is not zero and neither
of the ask or bid price should be zero. Finally, we can't have those
options whose expiration is zero.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}30}]:} \PY{c+c1}{\PYZsh{} clean the data one more time}
         \PY{n}{data\PYZus{}6} \PY{o}{=} \PY{n}{Data1}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{data\PYZus{}6} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{data\PYZus{}6} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{]}
         \PY{n}{data\PYZus{}6} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
\end{Verbatim}


    Then we define a function that implement the biseciton method to find
the implied volatility.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}31}]:} \PY{k}{def} \PY{n+nf}{get\PYZus{}iv}\PY{p}{(}\PY{n}{type\PYZus{}opt}\PY{p}{,} \PY{n}{r}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{P}\PY{p}{,}\PY{n}{tolerance}\PY{p}{,}\PY{n}{up}\PY{p}{,}\PY{n}{down}\PY{p}{)}\PY{p}{:}
             \PY{n}{obj\PYZus{}func}\PY{o}{=} \PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{BS\PYZus{}Formula}\PY{p}{(}\PY{n}{type\PYZus{}opt}\PY{p}{,} \PY{n}{r}\PY{p}{,} \PY{n}{x}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{P}
             \PY{k}{return} \PY{n}{Bisection}\PY{p}{(}\PY{n}{obj\PYZus{}func}\PY{p}{,}\PY{n}{tolerance}\PY{p}{,}\PY{n}{up}\PY{p}{,}\PY{n}{down}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} time the loop}
         \PY{n}{start} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} use the tolerance of 10e\PYZhy{}6 and the left guess is 0.00001 and right guess is 7}
         \PY{k}{for} \PY{n}{ind} \PY{o+ow}{in} \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}avrprice}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                        \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}iv}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} 
                                                        \PY{n}{rate}\PY{p}{,} \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                        \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                        \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} 
                                                        \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                        \PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{7}\PY{p}{,} \PY{l+m+mf}{0.00001}\PY{p}{)}
         
         \PY{n}{end} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
         \PY{n}{timespent1} \PY{o}{=} \PY{n}{end}\PY{o}{\PYZhy{}}\PY{n}{start}
         \PY{n}{data\PYZus{}6} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)} \PY{c+c1}{\PYZsh{} drop those don\PYZsq{}t have a root.}
         \PY{n}{amzn\PYZus{}at} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}}
                          \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{1.05}\PY{p}{)}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{amzn\PYZus{}at}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}31}]:}                 Strike     Expiry  Type    Last    Bid    Ask  Vol  \textbackslash{}
         Underlying                                                           
         AMZN       477  1512.5 2019-02-15  call   93.30  86.45  87.90  1.0   
                    478  1512.5 2019-02-15   put    2.78   2.47   2.60  3.0   
                    479  1512.5 2019-02-22  call  151.25  92.35  93.65  1.0   
                    480  1512.5 2019-02-22   put    8.40   7.15   7.50  1.0   
                    481  1515.0 2019-02-22  call  152.93  90.40  91.70  5.0   
         
                         Underlying\_Price       TtM  Avr\_Price  Implied\_vol\_bis  
         Underlying                                                              
         AMZN       477           1591.13  0.010959     87.175         0.525046  
                    478           1591.13  0.010959      2.535         0.365833  
                    479           1591.13  0.030137     93.000         0.386611  
                    480           1591.13  0.030137      7.325         0.306446  
                    481           1591.13  0.030137     91.050         0.386111  
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}32}]:} \PY{n}{spy\PYZus{}at} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}} 
                         \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{1.05}\PY{p}{)}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{spy\PYZus{}at}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}32}]:}                 Strike     Expiry  Type   Last    Bid    Ask    Vol  \textbackslash{}
         Underlying                                                            
         SPY        903   257.0 2019-02-13  call  12.93  13.84  14.03   51.0   
                    904   257.0 2019-02-13   put   0.01   0.01   0.02  338.0   
                    905   257.0 2019-02-19  call  14.44  14.01  14.25    8.0   
                    906   257.0 2019-02-19   put   0.12   0.14   0.15    5.0   
                    907   257.0 2019-02-20  call   8.58  14.16  14.39  103.0   
         
                         Underlying\_Price       TtM  Avr\_Price  Implied\_vol\_bis  
         Underlying                                                              
         SPY        903            270.45  0.005479     13.935         0.525145  
                    904            270.45  0.005479      0.015         0.287226  
                    905            270.45  0.021918     14.130         0.277817  
                    906            270.45  0.021918      0.145         0.204469  
                    907            270.47  0.024658     14.275         0.276260  
\end{Verbatim}
            
    Above is the at-the-money options's implied volatility.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}35}]:} \PY{c+c1}{\PYZsh{}pull out average implied volatilities of different options and assemble them}
         \PY{n}{amzn\PYZus{}at} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}} 
                          \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{1.05}\PY{p}{)}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{spy\PYZus{}at} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}} 
                         \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{1.05}\PY{p}{)}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{amzn\PYZus{}call\PYZus{}in\PYZus{}avriv} \PY{o}{=}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}
                                                        \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}} 
                            \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{amzn\PYZus{}call\PYZus{}out\PYZus{}avriv}\PY{o}{=}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}
                                                        \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{1.05}\PY{p}{)} \PY{o}{\PYZam{}} 
                            \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{amzn\PYZus{}put\PYZus{}out\PYZus{}avriv} \PY{o}{=}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}
                                                        \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}} 
                            \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{amzn\PYZus{}put\PYZus{}in\PYZus{}avriv}\PY{o}{=}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}
                                                      \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{1.05}\PY{p}{)} \PY{o}{\PYZam{}} 
                            \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{spy\PYZus{}call\PYZus{}in\PYZus{}avriv}\PY{o}{=}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}
                                                    \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}} 
                            \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{spy\PYZus{}call\PYZus{}out\PYZus{}avriv}\PY{o}{=}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}
                                                     \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{1.05}\PY{p}{)} \PY{o}{\PYZam{}} 
                            \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{spy\PYZus{}put\PYZus{}out\PYZus{}avriv}\PY{o}{=}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}
                                                    \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}} 
                            \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{spy\PYZus{}put\PYZus{}in\PYZus{}aviv}\PY{o}{=}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}
                                                  \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{1.05}\PY{p}{)} \PY{o}{\PYZam{}} 
                            \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{amzn\PYZus{}call\PYZus{}at\PYZus{}avriv} \PY{o}{=} \PY{n}{amzn\PYZus{}at}\PY{p}{[}\PY{n}{amzn\PYZus{}at}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{amzn\PYZus{}put\PYZus{}at\PYZus{}avriv} \PY{o}{=} \PY{n}{amzn\PYZus{}at}\PY{p}{[}\PY{n}{amzn\PYZus{}at}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{spy\PYZus{}call\PYZus{}at\PYZus{}avriv} \PY{o}{=} \PY{n}{spy\PYZus{}at}\PY{p}{[}\PY{n}{spy\PYZus{}at}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{spy\PYZus{}put\PYZus{}at\PYZus{}avriv} \PY{o}{=} \PY{n}{spy\PYZus{}at}\PY{p}{[}\PY{n}{spy\PYZus{}at}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         
         \PY{n}{Avr\PYZus{}Iv} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{[}\PY{p}{[}\PY{n}{amzn\PYZus{}call\PYZus{}in\PYZus{}avriv}\PY{p}{,}\PY{n}{amzn\PYZus{}put\PYZus{}in\PYZus{}avriv}\PY{p}{]}\PY{p}{,}
                                \PY{p}{[}\PY{n}{amzn\PYZus{}call\PYZus{}at\PYZus{}avriv}\PY{p}{,}\PY{n}{amzn\PYZus{}put\PYZus{}at\PYZus{}avriv}\PY{p}{]}\PY{p}{,}
                                \PY{p}{[}\PY{n}{amzn\PYZus{}call\PYZus{}out\PYZus{}avriv}\PY{p}{,}\PY{n}{amzn\PYZus{}put\PYZus{}out\PYZus{}avriv}\PY{p}{]}\PY{p}{,}
                                \PY{p}{[}\PY{n}{spy\PYZus{}call\PYZus{}in\PYZus{}avriv}\PY{p}{,}\PY{n}{spy\PYZus{}put\PYZus{}in\PYZus{}aviv}\PY{p}{]}\PY{p}{,}
                                \PY{p}{[}\PY{n}{spy\PYZus{}call\PYZus{}at\PYZus{}avriv}\PY{p}{,}\PY{n}{spy\PYZus{}put\PYZus{}at\PYZus{}avriv}\PY{p}{]}\PY{p}{,}
                                \PY{p}{[}\PY{n}{spy\PYZus{}call\PYZus{}out\PYZus{}avriv}\PY{p}{,}\PY{n}{spy\PYZus{}put\PYZus{}out\PYZus{}avriv}\PY{p}{]}\PY{p}{]}\PY{p}{,}
                                 \PY{n}{index} \PY{o}{=} \PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                          \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{in\PYZhy{}the money}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{at\PYZhy{}the\PYZhy{}money}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{out\PYZhy{}the money}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                           \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{in\PYZhy{}the money}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{at\PYZhy{}the\PYZhy{}money}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{out\PYZhy{}the money}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,}
                                 \PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{Avr\PYZus{}Iv}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Options}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Moneyness}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{Avr\PYZus{}Iv}\PY{o}{.}\PY{n}{columns}\PY{o}{.}\PY{n}{names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{k}{del} \PY{n}{amzn\PYZus{}call\PYZus{}in\PYZus{}avriv}\PY{p}{,}\PY{n}{amzn\PYZus{}call\PYZus{}out\PYZus{}avriv}\PY{p}{,}\PY{n}{amzn\PYZus{}put\PYZus{}out\PYZus{}avriv}\PY{p}{,}\PYZbs{}
         \PY{n}{amzn\PYZus{}put\PYZus{}in\PYZus{}avriv}\PY{p}{,}\PY{n}{spy\PYZus{}call\PYZus{}in\PYZus{}avriv}\PY{p}{,}\PY{n}{spy\PYZus{}call\PYZus{}out\PYZus{}avriv}\PY{p}{,}\PYZbs{}
         \PY{n}{spy\PYZus{}put\PYZus{}out\PYZus{}avriv}\PY{p}{,}\PY{n}{spy\PYZus{}put\PYZus{}in\PYZus{}aviv}\PY{p}{,}\PY{n}{amzn\PYZus{}at}\PY{p}{,}\PY{n}{spy\PYZus{}at}\PY{p}{,}\PY{n}{amzn\PYZus{}call\PYZus{}at\PYZus{}avriv}\PY{p}{,}\PYZbs{}
         \PY{n}{amzn\PYZus{}put\PYZus{}at\PYZus{}avriv}\PY{p}{,}\PY{n}{spy\PYZus{}call\PYZus{}at\PYZus{}avriv}\PY{p}{,}\PY{n}{spy\PYZus{}put\PYZus{}at\PYZus{}avriv}
         \PY{n}{Avr\PYZus{}Iv}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}35}]:} Type                       Call       Put
         Options Moneyness                        
         AMZN    in-the money   0.594830  0.345811
                 at-the-money   0.321056  0.277237
                 out-the money  0.332643  0.424691
         SPY     in-the money   0.495683  0.225012
                 at-the-money   0.161982  0.145370
                 out-the money  0.115556  0.298962
\end{Verbatim}
            
    Above is the average implied volatility of different type of options.

    \subsection{}\label{section}

\textbf{\emph{Implement the Newton method/Secant method or Muller method
to find the root of arbitrary functions...}}

Same to the last question, first we need to select the data and then we
define the method, at last we calulate the implied volatility.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}36}]:} \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{Data1}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}7}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{data\PYZus{}7}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}7}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{data\PYZus{}7}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{]}
         \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}7}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         
         \PY{k}{def} \PY{n+nf}{secant\PYZus{}method}\PY{p}{(}\PY{n}{func}\PY{p}{,} \PY{n}{guess1}\PY{p}{,} \PY{n}{guess2}\PY{p}{,} \PY{n}{tolerance}\PY{p}{)}\PY{p}{:}
             \PY{k}{if} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess1}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{n}{tolerance}\PY{p}{:}
                 \PY{k}{return} \PY{n}{guess1}
             \PY{k}{elif} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess2}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{n}{tolerance}\PY{p}{:}
                 \PY{k}{return} \PY{n}{guess2}
             \PY{k}{else}\PY{p}{:}
                 \PY{n}{new\PYZus{}guess} \PY{o}{=} \PY{n}{guess2}
             \PY{k}{while}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{new\PYZus{}guess}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZgt{}}\PY{n}{tolerance}\PY{p}{)}\PY{p}{:}
                 \PY{n}{k} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess2}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{func}\PY{p}{(}\PY{n}{guess1}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{n+nb}{float}\PY{p}{(}\PY{n}{guess2}\PY{o}{\PYZhy{}}\PY{n}{guess1}\PY{p}{)}
                 \PY{n}{new\PYZus{}guess} \PY{o}{=} \PY{n}{guess2}\PY{o}{\PYZhy{}}\PY{n}{func}\PY{p}{(}\PY{n}{guess2}\PY{p}{)}\PY{o}{/}\PY{n}{k}
                 \PY{n}{guess1} \PY{o}{=} \PY{n}{guess2}
                 \PY{n}{guess2} \PY{o}{=} \PY{n}{new\PYZus{}guess}
             \PY{k}{return} \PY{n}{new\PYZus{}guess}
         \PY{k}{def} \PY{n+nf}{get\PYZus{}iv2}\PY{p}{(}\PY{n}{type\PYZus{}opt}\PY{p}{,} \PY{n}{r}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{P}\PY{p}{,}\PY{n}{guess1}\PY{p}{,} \PY{n}{guess2}\PY{p}{,} \PY{n}{tolerance}\PY{p}{)}\PY{p}{:}
             \PY{n}{obj\PYZus{}func} \PY{o}{=} \PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{BS\PYZus{}Formula}\PY{p}{(}\PY{n}{type\PYZus{}opt}\PY{p}{,} \PY{n}{r}\PY{p}{,} \PY{n}{x}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{P}
             \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
         \PY{l+s+sd}{    if even at 0.0001 it still can\PYZsq{}t satisfy the condition, then there }
         \PY{l+s+sd}{    is no root and return nan}
         \PY{l+s+sd}{    \PYZsq{}\PYZsq{}\PYZsq{}}
             \PY{k}{if} \PY{n}{obj\PYZus{}func}\PY{p}{(}\PY{l+m+mf}{0.0001}\PY{p}{)}\PY{o}{\PYZgt{}}\PY{n}{tolerance}\PY{p}{:} 
                 \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{nan}
             \PY{k}{return} \PY{n}{secant\PYZus{}method}\PY{p}{(}\PY{n}{obj\PYZus{}func}\PY{p}{,} \PY{n}{guess1}\PY{p}{,} \PY{n}{guess2}\PY{p}{,} \PY{n}{tolerance}\PY{p}{)}
         \PY{n}{start} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
         \PY{k}{for} \PY{n}{ind2} \PY{o+ow}{in} \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}avrprice}\PY{p}{(}\PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                         \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}secant}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}iv2}\PY{p}{(}\PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{rate}\PY{p}{,}
                                                             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}
                                                                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                             \PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
         \PY{n}{end} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
         \PY{n}{timespent2} \PY{o}{=} \PY{n}{end}\PY{o}{\PYZhy{}}\PY{n}{start}
         \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}
         \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}36}]:}                Strike     Expiry  Type    Last     Bid     Ask   Vol  \textbackslash{}
         Underlying                                                             
         AMZN       1    710.0 2019-02-15  call  928.14  881.25  888.45  10.0   
                    3    760.0 2019-03-15  call  881.00  834.15  844.00  10.0   
                    8    765.0 2019-03-15  call  877.70  828.05  838.05   2.0   
                    17   790.0 2019-04-18   put    1.15    0.02    0.62   1.0   
                    18   800.0 2019-03-15  call  933.52  793.35  803.35   2.0   
         
                        Underlying\_Price       TtM  Avr\_Price  Implied\_vol\_secant  
         Underlying                                                                
         AMZN       1            1591.13  0.010959    884.850            3.846718  
                    3            1591.13  0.087671    839.075            1.390122  
                    8            1591.13  0.087671    833.050            1.336084  
                    17           1591.13  0.180822      0.320            0.616173  
                    18           1591.13  0.087671    798.350            1.272592  
\end{Verbatim}
            
    The above is the implied volatiltiy calulated by using the secant
method.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}37}]:} \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{Data1}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}7}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{data\PYZus{}7}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}7}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{data\PYZus{}7}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{]}
         \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}7}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         
         \PY{k}{def} \PY{n+nf}{muller\PYZus{}method}\PY{p}{(}\PY{n}{func}\PY{p}{,} \PY{n}{guess0}\PY{p}{,} \PY{n}{guess1}\PY{p}{,} \PY{n}{guess2}\PY{p}{,} \PY{n}{tolerance}\PY{p}{)}\PY{p}{:}
             \PY{k}{if} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess0}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{n}{tolerance}\PY{p}{:}
                 \PY{k}{return} \PY{n}{guess0}
             \PY{k}{elif} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess1}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{n}{tolerance}\PY{p}{:}
                 \PY{k}{return} \PY{n}{guess1}
             \PY{k}{elif} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess2}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{n}{tolerance}\PY{p}{:}
                 \PY{k}{return} \PY{n}{guess2}
             \PY{k}{else}\PY{p}{:}
                 \PY{n}{new\PYZus{}guess} \PY{o}{=} \PY{n}{guess2}
             \PY{k}{while}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{new\PYZus{}guess}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZgt{}}\PY{n}{tolerance}\PY{p}{)}\PY{p}{:}
                 \PY{n}{a} \PY{o}{=} \PY{p}{(}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess2}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{func}\PY{p}{(}\PY{n}{guess1}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{guess2}\PY{o}{\PYZhy{}}\PY{n}{guess1}\PY{p}{)}\PY{o}{\PYZhy{}}\PYZbs{}
                 \PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess1}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{func}\PY{p}{(}\PY{n}{guess0}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{guess1}\PY{o}{\PYZhy{}}\PY{n}{guess0}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{guess2}\PY{o}{\PYZhy{}}\PY{n}{guess0}\PY{p}{)}
                 \PY{n}{b} \PY{o}{=} \PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess1}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{func}\PY{p}{(}\PY{n}{guess0}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{guess1}\PY{o}{\PYZhy{}}\PY{n}{guess0}\PY{p}{)}\PY{o}{+}\PYZbs{}
                 \PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess2}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{func}\PY{p}{(}\PY{n}{guess0}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{guess2}\PY{o}{\PYZhy{}}\PY{n}{guess0}\PY{p}{)}\PY{o}{\PYZhy{}}\PYZbs{}
                 \PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{guess1}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{func}\PY{p}{(}\PY{n}{guess2}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{guess1}\PY{o}{\PYZhy{}}\PY{n}{guess2}\PY{p}{)}
                 \PY{n}{c} \PY{o}{=} \PY{n}{func}\PY{p}{(}\PY{n}{guess0}\PY{p}{)}
                 \PY{n}{delta} \PY{o}{=} \PY{n}{b}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{o}{*}\PY{n}{a}\PY{o}{*}\PY{n}{c}
         \PY{c+c1}{\PYZsh{} if it can\PYZsq{}t find a root when implelmenting a quadratic function, return nan}
                 \PY{k}{if} \PY{n}{delta}\PY{o}{\PYZlt{}}\PY{l+m+mi}{0}\PY{p}{:}
                     \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{nan}
                 \PY{n}{new\PYZus{}guess1} \PY{o}{=} \PY{n}{guess0}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{c}\PY{o}{/}\PY{p}{(}\PY{n}{b}\PY{o}{\PYZhy{}}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{b}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{o}{*}\PY{n}{a}\PY{o}{*}\PY{n}{c}\PY{p}{)}\PY{p}{)}
                 \PY{n}{new\PYZus{}guess2} \PY{o}{=} \PY{n}{guess0}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{c}\PY{o}{/}\PY{p}{(}\PY{n}{b}\PY{o}{+}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{b}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{o}{*}\PY{n}{a}\PY{o}{*}\PY{n}{c}\PY{p}{)}\PY{p}{)}
                 \PY{k}{if} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{new\PYZus{}guess1}\PY{p}{)}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{new\PYZus{}guess2}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                     \PY{n}{new\PYZus{}guess} \PY{o}{=} \PY{n}{new\PYZus{}guess1}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{new\PYZus{}guess} \PY{o}{=} \PY{n}{new\PYZus{}guess2}
                 \PY{n}{guess0} \PY{o}{=} \PY{n}{guess1}
                 \PY{n}{guess1} \PY{o}{=} \PY{n}{guess2}
                 \PY{n}{guess2} \PY{o}{=} \PY{n}{new\PYZus{}guess}
             \PY{k}{return} \PY{n}{new\PYZus{}guess}
         \PY{k}{def} \PY{n+nf}{get\PYZus{}iv3}\PY{p}{(}\PY{n}{type\PYZus{}opt}\PY{p}{,} \PY{n}{r}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{,} \PY{n}{P}\PY{p}{,} \PY{n}{guess0}\PY{p}{,} \PY{n}{guess1}\PY{p}{,} \PY{n}{guess2}\PY{p}{,} \PY{n}{tolerance}\PY{p}{)}\PY{p}{:}
             \PY{n}{obj\PYZus{}func} \PY{o}{=} \PY{k}{lambda} \PY{n}{x}\PY{p}{:} \PY{n}{BS\PYZus{}Formula}\PY{p}{(}\PY{n}{type\PYZus{}opt}\PY{p}{,} \PY{n}{r}\PY{p}{,} \PY{n}{x}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{P}
             \PY{k}{if} \PY{n}{obj\PYZus{}func}\PY{p}{(}\PY{l+m+mf}{0.0001}\PY{p}{)}\PY{o}{\PYZgt{}}\PY{n}{tolerance}\PY{p}{:}
                 \PY{k}{return} \PY{n}{np}\PY{o}{.}\PY{n}{nan}
             \PY{k}{return} \PY{n}{muller\PYZus{}method}\PY{p}{(}\PY{n}{obj\PYZus{}func}\PY{p}{,} \PY{n}{guess0}\PY{p}{,} \PY{n}{guess1}\PY{p}{,} \PY{n}{guess2}\PY{p}{,} \PY{n}{tolerance}\PY{p}{)}
         
         \PY{n}{start} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
         \PY{k}{for} \PY{n}{ind2} \PY{o+ow}{in} \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}avrprice}\PY{p}{(}\PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                         \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}muller}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}iv3}\PY{p}{(}\PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                             \PY{n}{rate}\PY{p}{,}
                                                             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                     \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                             \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                             \PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{l+m+mf}{0.000001}\PY{p}{)}
         \PY{n}{end} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
         \PY{n}{timespent3} \PY{o}{=} \PY{n}{end}\PY{o}{\PYZhy{}}\PY{n}{start}
         \PY{n}{data\PYZus{}7} \PY{o}{=} \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}
         \PY{n}{data\PYZus{}7}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}37}]:}                Strike     Expiry  Type    Last     Bid     Ask   Vol  \textbackslash{}
         Underlying                                                             
         AMZN       1    710.0 2019-02-15  call  928.14  881.25  888.45  10.0   
                    3    760.0 2019-03-15  call  881.00  834.15  844.00  10.0   
                    8    765.0 2019-03-15  call  877.70  828.05  838.05   2.0   
                    17   790.0 2019-04-18   put    1.15    0.02    0.62   1.0   
                    18   800.0 2019-03-15  call  933.52  793.35  803.35   2.0   
         
                        Underlying\_Price       TtM  Avr\_Price  Implied\_vol\_muller  
         Underlying                                                                
         AMZN       1            1591.13  0.010959    884.850            3.846718  
                    3            1591.13  0.087671    839.075            1.390122  
                    8            1591.13  0.087671    833.050            1.336084  
                    17           1591.13  0.180822      0.320            0.616173  
                    18           1591.13  0.087671    798.350            1.272592  
\end{Verbatim}
            
    The above is the implied volatility calculated by using the muller
method. As you can see in the table, the results of these two time's
calulation is identical.

To be cleare, when using the secant method some implied volatility
result in infinite. The reason may lies in the algorithm's defect which
means the first derivative of the function at some points leads the next
point goes far away, not near to, the real root and never comes back
during the iteration.

As for the muller method, there is also a critical issue. It is
important for us to realize that the muller method is using the
quadratic function to get us the root. However, when implementing the
quadratic funciton to find the next point, it is possible that this
quadratic function doesn't have roots itself, so it will stop iterating
even though the original function may have the root over somewhere.

Although these little issues may lead us some warning when we running
the program, nevertheless we can get most of the results. And we can
still compare the time consumed of different methods.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}38}]:} \PY{n}{Time\PYZus{}Consumed} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{[}\PY{p}{[}\PY{n}{timespent1}\PY{p}{,}\PY{n}{timespent2}\PY{p}{,}\PY{n}{timespent3}\PY{p}{]}\PY{p}{]}\PY{p}{,}
                                      \PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time consumed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                      \PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bisection(s)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Secant(s)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Muller(s)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{Time\PYZus{}Consumed}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}38}]:}                Bisection(s)  Secant(s)  Muller(s)
         Time consumed     40.401037  21.118584  36.868597
\end{Verbatim}
            
    As we can see, the secant method is the fastest method on this problem.

\subsection{}\label{section}

Select the previously calculated data which is data\_6. Then we
calculate the average implied volatility for every stock, options type
and maturity.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}40}]:} \PY{n}{data\PYZus{}8} \PY{o}{=} \PY{n}{data\PYZus{}6}
         \PY{c+c1}{\PYZsh{} Here is AMZN}
         \PY{n}{amzn\PYZus{}call\PYZus{}8} \PY{o}{=} \PY{n}{data\PYZus{}8}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}8}\PY{o}{.}\PY{n}{Type}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{amzn\PYZus{}put\PYZus{}8} \PY{o}{=} \PY{n}{data\PYZus{}8}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}8}\PY{o}{.}\PY{n}{Type}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{c+c1}{\PYZsh{} create an index contain the expiry date both in call and put}
         \PY{n}{amzn\PYZus{}result\PYZus{}table} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{set}\PY{p}{(}\PY{n}{amzn\PYZus{}call\PYZus{}8}\PY{o}{.}\PY{n}{Expiry}\PY{p}{)}\PYZbs{}
                                               \PY{o}{.}\PY{n}{intersection}\PY{p}{(}\PY{n+nb}{set}\PY{p}{(}\PY{n}{amzn\PYZus{}put\PYZus{}8}\PY{o}{.}\PY{n}{Expiry}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                               \PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} find those average implied volatility for each maturity and type.}
         \PY{k}{for} \PY{n}{ind8} \PY{o+ow}{in} \PY{n}{amzn\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{amzn\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind8}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN\PYZus{}Call\PYZus{}IV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{amzn\PYZus{}call\PYZus{}8}\PY{p}{[}\PY{n}{amzn\PYZus{}call\PYZus{}8}\PYZbs{}
                                     \PY{o}{.}\PY{n}{Expiry} \PY{o}{==} \PY{n}{amzn\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind8}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PYZbs{}
                                     \PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
             \PY{n}{amzn\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind8}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN\PYZus{}Put\PYZus{}IV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{amzn\PYZus{}put\PYZus{}8}\PY{p}{[}\PY{n}{amzn\PYZus{}put\PYZus{}8}\PYZbs{}
                                     \PY{o}{.}\PY{n}{Expiry} \PY{o}{==} \PY{n}{amzn\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind8}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PYZbs{}
                                     \PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{amzn\PYZus{}result\PYZus{}table} \PY{o}{=} \PY{n}{amzn\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{by}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{amzn\PYZus{}result\PYZus{}table} \PY{o}{=} \PY{n}{amzn\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{keys}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} Do the same thing to the SPY options}
         \PY{n}{spy\PYZus{}call\PYZus{}8} \PY{o}{=} \PY{n}{data\PYZus{}8}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}8}\PY{o}{.}\PY{n}{Type}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{spy\PYZus{}put\PYZus{}8} \PY{o}{=} \PY{n}{data\PYZus{}8}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}8}\PY{o}{.}\PY{n}{Type}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{spy\PYZus{}result\PYZus{}table} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{set}\PY{p}{(}\PY{n}{spy\PYZus{}call\PYZus{}8}\PY{o}{.}\PY{n}{Expiry}\PY{p}{)}\PY{o}{.}\PYZbs{}
                                 \PY{n}{intersection}\PY{p}{(}\PY{n+nb}{set}\PY{p}{(}\PY{n}{spy\PYZus{}put\PYZus{}8}\PY{o}{.}\PY{n}{Expiry}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{,}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{k}{for} \PY{n}{ind8} \PY{o+ow}{in} \PY{n}{spy\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{spy\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind8}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY\PYZus{}Call\PYZus{}IV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{spy\PYZus{}call\PYZus{}8}\PY{p}{[}\PY{n}{spy\PYZus{}call\PYZus{}8}\PY{o}{.}\PY{n}{Expiry} \PY{o}{==} \PYZbs{}
                             \PY{n}{spy\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind8}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
             \PY{n}{spy\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind8}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY\PYZus{}Put\PYZus{}IV}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{spy\PYZus{}put\PYZus{}8}\PY{p}{[}\PY{n}{spy\PYZus{}put\PYZus{}8}\PY{o}{.}\PY{n}{Expiry} \PY{o}{==} \PYZbs{}
                             \PY{n}{spy\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind8}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
         \PY{n}{spy\PYZus{}result\PYZus{}table} \PY{o}{=} \PY{n}{spy\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{by}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{spy\PYZus{}result\PYZus{}table} \PY{o}{=} \PY{n}{spy\PYZus{}result\PYZus{}table}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{keys}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{k}{del} \PY{n}{amzn\PYZus{}call\PYZus{}8}\PY{p}{,}\PY{n}{amzn\PYZus{}put\PYZus{}8}\PY{p}{,}\PY{n}{spy\PYZus{}call\PYZus{}8}\PY{p}{,}\PY{n}{spy\PYZus{}put\PYZus{}8}
         \PY{n}{amzn\PYZus{}result\PYZus{}table}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}40}]:}             AMZN\_Call\_IV  AMZN\_Put\_IV
         Expiry                               
         2019-02-15      0.497942     0.448613
         2019-02-22      0.407998     0.373496
         2019-03-01      0.356439     0.297806
         2019-03-08      0.313701     0.307496
         2019-03-15      0.541567     0.457329
         2019-03-22      0.300207     0.296794
         2019-03-29      0.298183     0.290915
         2019-04-18      0.335098     0.364129
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}41}]:} \PY{n}{spy\PYZus{}result\PYZus{}table}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}41}]:}             SPY\_Call\_IV  SPY\_Put\_IV
         Expiry                             
         2019-02-13     0.432727    0.206788
         2019-02-15     1.216522    0.256723
         2019-02-19     0.231091    0.220734
         2019-02-20     0.193170    0.177107
         2019-02-22     0.254042    0.223280
         2019-02-25     0.184780    0.182386
         2019-02-27     0.158320    0.189325
         2019-03-01     0.216543    0.208386
         2019-03-04     0.159101    0.186544
         2019-03-06     0.164503    0.182690
         2019-03-08     0.172159    0.186817
         2019-03-11     0.153474    0.167904
         2019-03-13     0.153910    0.175712
         2019-03-15     0.568965    0.320300
         2019-03-18     0.128571    0.147787
         2019-03-22     0.136494    0.190206
         2019-03-29     0.157946    0.258679
         2019-04-18     0.172012    0.265789
\end{Verbatim}
            
    \textbf{\emph{Comment on the observes difference in values obtained for
AMZN and SPY.}}

As we can see in these two tables, the SPY options' implied volatility
is, in general, smaller than those of AMZN options. The reason may be
the underlying of SPY is index, in another words, whole bunch of stocks
is much diversified than a single stock. This property of SPY leads to
the lower volatility.

\textbf{\emph{Compare with the current value of the VIX}}

The current value of VIX is 16.27 which refers to the implied volatility
of SPY to be 0.1627. In the previous question we have already got the
at-the-money call/put options' implied volatility of SPY, which is
0.161982 and 0.145370. These numbers is quite close to the price of SPY.
The AMZN's options' volatility is greater than VIX price.

\textbf{\emph{Comment on what happens when the maturity increases.
Comment on what happen when the options become in the money respectively
out of the money.}}

When the maturity increases, the volatility of the each underlying is
decreasing. As we can see in the previous question, for the call
options, in-the-money implied volatility is higher than those of
out-of-the-money options. As for the put options, the conclusion is
opposite.

    \subsection{}\label{section}

\textbf{\emph{For each option in your table calculate the price of the
different type (Call/Put) using the Put-Call parity...}}

In order to get more available data for both call and put options, we
use the at-the-money data. Then we use the put-call parity to givr their
counterparties prices. The put-call parity is:

\[C-P=S-Ke^{-rT}\]

At here, we present the table of all the market prices and calculated
prices from call-put parity.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}42}]:} \PY{c+c1}{\PYZsh{} use the at\PYZhy{}the\PYZhy{}money data to better present the results}
         \PY{n}{data\PYZus{}9} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZgt{}}\PY{l+m+mf}{0.95}\PY{p}{)} \PY{o}{\PYZam{}}\PYZbs{}
                         \PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{/}\PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mf}{1.05}\PY{p}{)}\PY{p}{]}
         \PY{c+c1}{\PYZsh{} define the put\PYZhy{}call parity method}
         \PY{k}{def} \PY{n+nf}{put\PYZus{}call\PYZus{}parity}\PY{p}{(}\PY{n}{opt\PYZus{}type}\PY{p}{,}  \PY{n}{r}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,}\PY{n}{T}\PY{p}{,} \PY{n}{price}\PY{p}{)}\PY{p}{:}
             \PY{k}{if} \PY{n}{opt\PYZus{}type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
                 \PY{k}{return} \PY{n}{price}\PY{o}{\PYZhy{}}\PY{n}{S}\PY{o}{+}\PY{n}{K}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{n}{T}\PY{p}{)}
             \PY{k}{else}\PY{p}{:}
                 \PY{k}{return} \PY{n}{S}\PY{o}{\PYZhy{}}\PY{n}{K}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{n}{T}\PY{p}{)}\PY{o}{+}\PY{n}{price}
         \PY{n}{call\PYZus{}9} \PY{o}{=} \PY{n}{data\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}9}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
         \PY{n}{put\PYZus{}9} \PY{o}{=} \PY{n}{data\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}9}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
         \PY{n}{call\PYZus{}put\PYZus{}9} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{call\PYZus{}9}\PY{p}{,}\PY{n}{put\PYZus{}9}\PY{p}{,}\PY{n}{on}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                               \PY{n}{how}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{outer}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{suffixes}\PY{o}{=}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{k}{for} \PY{n}{ind9} \PY{o+ow}{in} \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Calculated\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PYZbs{}
             \PY{n}{put\PYZus{}call\PYZus{}parity}\PY{p}{(}\PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                             \PY{n}{rate}\PY{p}{,}\PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                             \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                             \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                             \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Calculated\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PYZbs{}
             \PY{n}{put\PYZus{}call\PYZus{}parity}\PY{p}{(}\PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                             \PY{n}{rate}\PY{p}{,} \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                             \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                             \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                             \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind9}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{call\PYZus{}put\PYZus{}9} \PY{o}{=} \PY{n}{call\PYZus{}put\PYZus{}9}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                  \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Calculated\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                  \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Calculated\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price\PYZus{}put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{n}{call\PYZus{}put\PYZus{}9} \PY{o}{=} \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{rename}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price\PYZus{}call}\PY{l+s+s1}{\PYZsq{}} \PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{\PYZcb{}}\PY{p}{)}
         \PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}42}]:}    Strike     Expiry  Underlying\_Price  Avr\_Price\_call  Calculated\_call  \textbackslash{}
         0  1512.5 2019-02-15           1591.13          87.175        81.562756   
         1  1512.5 2019-02-22           1591.13          93.000        87.048577   
         2  1515.0 2019-02-22           1591.13          91.050        84.900385   
         3  1515.0 2019-03-01           1591.13          96.875        91.672035   
         4  1515.0 2019-03-22           1591.13         114.675       107.960064   
         
           Type\_call Type\_put  Calculated\_put  Avr\_Price\_put  
         0      call      put        8.147244          2.535  
         1      call      put       13.276423          7.325  
         2      call      put       13.824615          7.675  
         3      call      put       18.952965         13.750  
         4      call      put       34.664936         27.950  
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}43}]:} \PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{Calculated\PYZus{}call}\PY{o}{\PYZhy{}}\PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{Avr\PYZus{}Price\PYZus{}call}\PY{p}{)}\PY{o}{+}\PYZbs{}
         \PY{n+nb}{abs}\PY{p}{(}\PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{Calculated\PYZus{}put}\PY{o}{\PYZhy{}}\PY{n}{call\PYZus{}put\PYZus{}9}\PY{o}{.}\PY{n}{Avr\PYZus{}Price\PYZus{}put}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{2}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}43}]:} 2.2850669975498796
\end{Verbatim}
            
    The average difference of the market price and calculated price is about
2.29.

    \subsection{}\label{section}

\textbf{\emph{Create a 2 dimensional plot of implied volatilities versus
strike K for the closest to maturity options...}}

We take either the call or put options data and plot their implied
volatility with strikes. The reason why we only get one type of stock
option is to prevent the zigzag like graph which is caused by the
different imlplied volatility of each type of options.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}44}]:} \PY{c+c1}{\PYZsh{} get the implied volatility data from bisection methods}
         \PY{n}{amzn\PYZus{}10} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{amzn\PYZus{}10} \PY{o}{=} \PY{n}{amzn\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{amzn\PYZus{}10}\PY{o}{.}\PY{n}{Type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{c+c1}{\PYZsh{} use 2019\PYZhy{}02\PYZhy{}15, 2019\PYZhy{}03\PYZhy{}15 and 2019\PYZhy{}04\PYZhy{}18 as the date points}
         \PY{n}{amzn\PYZus{}10\PYZus{}215} \PY{o}{=} \PY{n}{amzn\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{amzn\PYZus{}10}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}02\PYZhy{}15}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{amzn\PYZus{}10\PYZus{}315} \PY{o}{=} \PY{n}{amzn\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{amzn\PYZus{}10}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}03\PYZhy{}15}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{amzn\PYZus{}10\PYZus{}418} \PY{o}{=} \PY{n}{amzn\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{amzn\PYZus{}10}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}04\PYZhy{}18}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{c+c1}{\PYZsh{} plot implied volatilities with different oprions\PYZsq{} strike and expiry}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{amzn\PYZus{}10\PYZus{}215}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{amzn\PYZus{}10\PYZus{}215}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2\PYZhy{}15}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{amzn\PYZus{}10\PYZus{}315}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{amzn\PYZus{}10\PYZus{}315}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{3\PYZhy{}15}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{amzn\PYZus{}10\PYZus{}418}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{amzn\PYZus{}10\PYZus{}418}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{4\PYZhy{}18}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied Volatility}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN Call Volatility Smile}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{del} \PY{n}{amzn\PYZus{}10\PYZus{}215}\PY{p}{,}\PY{n}{amzn\PYZus{}10\PYZus{}315}\PY{p}{,}\PY{n}{amzn\PYZus{}10\PYZus{}418}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_48_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}45}]:} \PY{n}{spy\PYZus{}10} \PY{o}{=} \PY{n}{Data1}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{spy\PYZus{}10} \PY{o}{=} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{spy\PYZus{}10}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{spy\PYZus{}10} \PY{o}{=} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{spy\PYZus{}10}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{spy\PYZus{}10} \PY{o}{=} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{Type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{put}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
         \PY{c+c1}{\PYZsh{} use the put options to better compare with the previous one}
         \PY{k}{for} \PY{n}{ind2} \PY{o+ow}{in} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}avrprice}\PY{p}{(}\PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                         \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}iv}\PY{p}{(}\PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                         \PY{n}{rate}\PY{p}{,} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                         \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                         \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                         \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                         \PY{l+m+mf}{0.000001}\PY{p}{,}\PY{l+m+mi}{7}\PY{p}{,}\PY{l+m+mf}{0.001}\PY{p}{)}
         \PY{n}{spy\PYZus{}10} \PY{o}{=} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} use 2019\PYZhy{}02\PYZhy{}15, 2019\PYZhy{}03\PYZhy{}15 and 2019\PYZhy{}04\PYZhy{}18 as the date points}
         \PY{n}{spy\PYZus{}10\PYZus{}215} \PY{o}{=} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{spy\PYZus{}10}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}02\PYZhy{}15}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{spy\PYZus{}10\PYZus{}315} \PY{o}{=} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{spy\PYZus{}10}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}03\PYZhy{}15}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{spy\PYZus{}10\PYZus{}418} \PY{o}{=} \PY{n}{spy\PYZus{}10}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{spy\PYZus{}10}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}04\PYZhy{}18}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{spy\PYZus{}10\PYZus{}215}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{spy\PYZus{}10\PYZus{}215}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2\PYZhy{}15}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{spy\PYZus{}10\PYZus{}315}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{spy\PYZus{}10\PYZus{}315}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{3\PYZhy{}15}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{spy\PYZus{}10\PYZus{}418}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{spy\PYZus{}10\PYZus{}418}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{4\PYZhy{}18}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied Volatility}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN Put Volatility Smile}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{del} \PY{n}{spy\PYZus{}10\PYZus{}215}\PY{p}{,}\PY{n}{spy\PYZus{}10\PYZus{}315}\PY{p}{,}\PY{n}{spy\PYZus{}10\PYZus{}418}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_49_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The closest maturity monthly is 2019-02-15, and they are presented
above. We can find that as the strike price increases, the implied
volatility is about to decrease and goes up again when strike hits
certain price.

\textbf{\emph{Bonus}}

\textbf{\emph{Create a 3d plot of volatility surface.}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}46}]:} \PY{k+kn}{from} \PY{n+nn}{mpl\PYZus{}toolkits}\PY{n+nn}{.}\PY{n+nn}{mplot3d} \PY{k}{import} \PY{n}{Axes3D}
         \PY{c+c1}{\PYZsh{} plot the volatility surface of AMZN call options }
         \PY{n}{amzn\PYZus{}10\PYZus{}3d} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{amzn\PYZus{}10\PYZus{}3d} \PY{o}{=} \PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{amzn\PYZus{}10\PYZus{}3d} \PY{o}{=} \PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{amzn\PYZus{}10\PYZus{}3d} \PY{o}{=} \PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{o}{.}\PY{n}{Type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{amzn\PYZus{}10\PYZus{}3d} \PY{o}{=} \PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{by}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         
         \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{o}{.}\PY{n}{Strike}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{)}
         \PY{n}{y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{o}{.}\PY{n}{TtM}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{o}{*}\PY{l+m+mi}{365}\PY{p}{)}
         \PY{n}{z} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{amzn\PYZus{}10\PYZus{}3d}\PY{o}{.}\PY{n}{Implied\PYZus{}vol\PYZus{}bis}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{p}{)}
         
         \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
         \PY{n}{ax} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{gca}\PY{p}{(}\PY{n}{projection}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{3d}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{ax}\PY{o}{.}\PY{n}{plot\PYZus{}trisurf}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{y}\PY{p}{,}\PY{n}{z}\PY{p}{,}\PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{plasma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike Price(\PYZdl{})}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time to Matuity(Days)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}zlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied Volatility}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}46}]:} Text(0.5,0,'Implied Volatility')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_51_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{}\label{section}

\textbf{\emph{Calculate the derivatives of the call option price with
respect to S (Delta), and \(\sigma\) (Vega) and the second derivative
with respect to S (Gamma).}}

This is the geek letters of the call options.

\[\Delta=N(d_1)\]

\[d_1=\frac{ln(S/K)+(r+\sigma^2/2)T}{\sigma\sqrt{T}}\]

\[\nu=S\sqrt{T}N(d_1)\]

\[\Gamma=\frac{N(d_1)}{S\sigma\sqrt{T}}\]

We will get different kinds of derivatives by two method, one way is the
BS formula, the second way is using the numerical method. They will be
very close to each others.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}47}]:} \PY{c+c1}{\PYZsh{}define the BS methods}
         
         \PY{k}{def} \PY{n+nf}{Delta\PYZus{}call}\PY{p}{(}\PY{n}{r}\PY{p}{,} \PY{n}{vol}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{)}\PY{p}{:}
             \PY{n}{d\PYZus{}1} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{m}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{S}\PY{o}{/}\PY{n}{K}\PY{p}{)}\PY{o}{+}\PY{p}{(}\PY{n}{r}\PY{o}{+}\PY{n}{vol}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{n}{T}\PY{p}{)}\PY{o}{/}\PY{n+nb}{float}\PY{p}{(}\PY{n}{vol}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{)}
             \PY{k}{return} \PY{n}{norm}\PY{o}{.}\PY{n}{cdf}\PY{p}{(}\PY{n}{d\PYZus{}1}\PY{p}{)}
         \PY{k}{def} \PY{n+nf}{Gamma}\PY{p}{(}\PY{n}{r}\PY{p}{,} \PY{n}{vol}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{)}\PY{p}{:}
             \PY{n}{d\PYZus{}1} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{m}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{S}\PY{o}{/}\PY{n}{K}\PY{p}{)}\PY{o}{+}\PY{p}{(}\PY{n}{r}\PY{o}{+}\PY{n}{vol}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{n}{T}\PY{p}{)}\PY{o}{/}\PY{n+nb}{float}\PY{p}{(}\PY{n}{vol}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{)}
             \PY{k}{return} \PY{n}{norm}\PY{o}{.}\PY{n}{pdf}\PY{p}{(}\PY{n}{d\PYZus{}1}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{S}\PY{o}{*}\PY{n}{vol}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{)}
         \PY{k}{def} \PY{n+nf}{Vega}\PY{p}{(}\PY{n}{r}\PY{p}{,} \PY{n}{vol}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{)}\PY{p}{:}
             \PY{n}{d\PYZus{}1} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{m}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{S}\PY{o}{/}\PY{n}{K}\PY{p}{)}\PY{o}{+}\PY{p}{(}\PY{n}{r}\PY{o}{+}\PY{n}{vol}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{n}{T}\PY{p}{)}\PY{o}{/}\PY{n+nb}{float}\PY{p}{(}\PY{n}{vol}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{p}{)}
             \PY{k}{return} \PY{n}{S}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{T}\PY{p}{)}\PY{o}{*}\PY{n}{norm}\PY{o}{.}\PY{n}{pdf}\PY{p}{(}\PY{n}{d\PYZus{}1}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} define the numerical methods}
         
         \PY{k}{def} \PY{n+nf}{First\PYZus{}dir}\PY{p}{(}\PY{n}{func}\PY{p}{,} \PY{n}{small\PYZus{}gap}\PY{p}{,} \PY{n}{x}\PY{p}{)}\PY{p}{:}
             \PY{k}{return} \PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{x}\PY{o}{+}\PY{n}{small\PYZus{}gap}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{func}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{small\PYZus{}gap}\PY{p}{)}
         \PY{k}{def} \PY{n+nf}{Second\PYZus{}dir}\PY{p}{(}\PY{n}{func}\PY{p}{,}\PY{n}{small\PYZus{}gap}\PY{p}{,}\PY{n}{x}\PY{p}{)}\PY{p}{:}
             \PY{k}{return} \PY{p}{(}\PY{n}{func}\PY{p}{(}\PY{n}{x}\PY{o}{+}\PY{n}{small\PYZus{}gap}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{func}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{o}{+}\PY{n}{func}\PY{p}{(}\PY{n}{x}\PY{o}{\PYZhy{}}\PY{n}{small\PYZus{}gap}\PY{p}{)}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n}{small\PYZus{}gap}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}
         \PY{k}{def} \PY{n+nf}{get\PYZus{}num\PYZus{}delta\PYZus{}call}\PY{p}{(} \PY{n}{r}\PY{p}{,} \PY{n}{vol}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S\PYZus{}with\PYZus{}respct}\PY{p}{,} \PY{n}{T}\PY{p}{,}\PY{n}{small\PYZus{}gap}\PY{p}{)}\PY{p}{:}
             \PY{n}{BS\PYZus{}s} \PY{o}{=} \PY{k}{lambda} \PY{n}{s}\PY{p}{:} \PY{n}{BS\PYZus{}Formula}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{r}\PY{p}{,}\PY{n}{vol}\PY{p}{,}\PY{n}{K}\PY{p}{,}\PY{n}{s}\PY{p}{,}\PY{n}{T}\PY{p}{)}
             \PY{k}{return} \PY{n}{First\PYZus{}dir}\PY{p}{(}\PY{n}{BS\PYZus{}s}\PY{p}{,} \PY{n}{small\PYZus{}gap}\PY{p}{,} \PY{n}{S\PYZus{}with\PYZus{}respct}\PY{p}{)}
         \PY{k}{def} \PY{n+nf}{get\PYZus{}num\PYZus{}gamma}\PY{p}{(} \PY{n}{r}\PY{p}{,} \PY{n}{vol}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S\PYZus{}with\PYZus{}respct}\PY{p}{,} \PY{n}{T}\PY{p}{,}\PY{n}{small\PYZus{}gap}\PY{p}{)}\PY{p}{:}
             \PY{n}{BS\PYZus{}s} \PY{o}{=} \PY{k}{lambda} \PY{n}{s}\PY{p}{:} \PY{n}{BS\PYZus{}Formula}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{r}\PY{p}{,}\PY{n}{vol}\PY{p}{,}\PY{n}{K}\PY{p}{,}\PY{n}{s}\PY{p}{,}\PY{n}{T}\PY{p}{)}
             \PY{k}{return} \PY{n}{Second\PYZus{}dir}\PY{p}{(}\PY{n}{BS\PYZus{}s}\PY{p}{,} \PY{n}{small\PYZus{}gap}\PY{p}{,} \PY{n}{S\PYZus{}with\PYZus{}respct}\PY{p}{)}
         \PY{k}{def} \PY{n+nf}{get\PYZus{}num\PYZus{}vega}\PY{p}{(} \PY{n}{r}\PY{p}{,} \PY{n}{vol\PYZus{}with\PYZus{}respct}\PY{p}{,} \PY{n}{K}\PY{p}{,} \PY{n}{S}\PY{p}{,} \PY{n}{T}\PY{p}{,}\PY{n}{small\PYZus{}gap}\PY{p}{)}\PY{p}{:}
             \PY{n}{BS\PYZus{}sigma} \PY{o}{=} \PY{k}{lambda} \PY{n}{sigma}\PY{p}{:} \PY{n}{BS\PYZus{}Formula}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{r}\PY{p}{,}\PY{n}{sigma}\PY{p}{,}\PY{n}{K}\PY{p}{,}\PY{n}{S}\PY{p}{,}\PY{n}{T}\PY{p}{)}
             \PY{k}{return} \PY{n}{First\PYZus{}dir}\PY{p}{(}\PY{n}{BS\PYZus{}sigma}\PY{p}{,} \PY{n}{small\PYZus{}gap}\PY{p}{,} \PY{n}{vol\PYZus{}with\PYZus{}respct}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Get the call optons}
         
         \PY{n}{data\PYZus{}11} \PY{o}{=} \PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}6}\PY{o}{.}\PY{n}{Type} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{call}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         
         \PY{c+c1}{\PYZsh{} Do the calculation}
         
         \PY{k}{for} \PY{n}{ind11} \PY{o+ow}{in} \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Delta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{Delta\PYZus{}call}\PY{p}{(}\PY{n}{rate}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Gamma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{Gamma}\PY{p}{(}\PY{n}{rate}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vega}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{Vega}\PY{p}{(}\PY{n}{rate}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Numerical\PYZus{}Delta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{n}{get\PYZus{}num\PYZus{}delta\PYZus{}call}\PY{p}{(}\PY{n}{rate}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
             \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Numerical\PYZus{}Gamma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{n}{get\PYZus{}num\PYZus{}gamma}\PY{p}{(}\PY{n}{rate}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
             \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Numerical\PYZus{}Vega}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{n}{get\PYZus{}num\PYZus{}vega}\PY{p}{(}\PY{n}{rate}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind11}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{data\PYZus{}11} \PY{o}{=} \PY{n}{data\PYZus{}11}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Delta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Gamma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vega}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Numerical\PYZus{}Delta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Numerical\PYZus{}Gamma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Numerical\PYZus{}Vega}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{n}{data\PYZus{}11}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}



\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}47}]:}                Strike     Expiry  Type     Delta     Gamma       Vega  \textbackslash{}
         Underlying                                                              
         AMZN       1    710.0 2019-02-15  call  0.986303  0.000055   5.833287   
                    3    760.0 2019-03-15  call  0.977574  0.000081  25.130826   
                    8    765.0 2019-03-15  call  0.980025  0.000077  22.786571   
                    18   800.0 2019-03-15  call  0.978244  0.000087  24.495055   
                    24   820.0 2019-03-15  call  0.977935  0.000091  24.789029   
         
                        Numerical\_Delta  Numerical\_Gamma  Numerical\_Vega  
         Underlying                                                       
         AMZN       1          0.986303         0.000057        5.833589  
                    3          0.977574         0.000045       25.133717  
                    8          0.980025         0.000102       22.789477  
                    18         0.978244         0.000102       24.498245  
                    24         0.977935         0.000091       24.792385  
\end{Verbatim}
            
    As we can see in this table, the results of these two methods is indeed
quite similar.

\subsection{}\label{section}

\textbf{\emph{we will use the second dataset DATA2. For each strike
price in the data use the Stock price for the same day, the implied
volatility you...}}

Fist of all, we need also clean the Data2 and we need to find those
options that share the same properties. Then we use the implied
volatility obtained from Data1 to give the option price of Data2.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}29}]:} \PY{c+c1}{\PYZsh{} get all available data from Data2 and clean them}
         \PY{n}{data\PYZus{}12} \PY{o}{=} \PY{n}{Data2}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AMZN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPY}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{data\PYZus{}12} \PY{o}{=} \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}12}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{data\PYZus{}12} \PY{o}{=} \PY{n}{data\PYZus{}12}\PY{p}{[}\PY{p}{(}\PY{n}{data\PYZus{}12}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{data\PYZus{}12}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{]}
         \PY{n}{data\PYZus{}12} \PY{o}{=} \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data\PYZus{}12}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{} }
         \PY{l+s+sd}{Merge the implied volatility data with the Data2 in order to find the options type}
         \PY{l+s+sd}{that we can apply our previously calculated implied volatility onto the next day\PYZsq{}s }
         \PY{l+s+sd}{data set.}
         
         \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}} 
         \PY{n}{data\PYZus{}12} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{data\PYZus{}6}\PY{p}{,}\PY{n}{data\PYZus{}12}\PY{p}{,}
                            \PY{n}{on}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                            \PY{n}{how}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{inner}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Last\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Vol\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{c+c1}{\PYZsh{} Do the calculation}
         \PY{k}{for} \PY{n}{ind12} \PY{o+ow}{in} \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{index}\PY{p}{:}
             \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{BS\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{BS\PYZus{}Formula}\PY{p}{(}\PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{rate}\PY{p}{,} \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Implied\PYZus{}vol\PYZus{}bis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} 
                        \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Underlying\PYZus{}Price\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                        \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{TtM\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{get\PYZus{}avrprice}\PY{p}{(}\PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bid\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
                                                           \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{ind12}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Ask\PYZus{}y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{data\PYZus{}12} \PY{o}{=} \PY{n}{data\PYZus{}12}\PY{p}{[}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Strike}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Expiry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Avr\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{BS\PYZus{}Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
         \PY{n}{data\PYZus{}12}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}29}]:}    Strike     Expiry  Type  Avr\_Price    BS\_Price
         0   710.0 2019-02-15  call     920.05  920.293574
         1   760.0 2019-03-15  call     870.45  875.704239
         2   765.0 2019-03-15  call     866.85  869.835077
         3   800.0 2019-03-15  call     832.10  835.063438
         4   800.0 2019-03-15   put       0.04    0.039228
\end{Verbatim}
            
    The options price (BS\_Price) we calcualte is quite close to the real
market price (Avr\_Price) of the next day. So we can partly predict the
options price by having the implied volatility from the first day.

\section{Part 3}\label{part-3}

\subsection{}\label{section}

\textbf{\emph{Implement the trapezoidal and the Simpson's quadrature
rules to numerically approximate the indenite integral above.}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{k}{def} \PY{n+nf}{func1}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{p}{:}
            \PY{k}{if} \PY{n}{x} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
                \PY{k}{return} \PY{l+m+mi}{1}
            \PY{k}{else}\PY{p}{:}
                \PY{k}{return} \PY{n}{m}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{o}{/}\PY{n}{x}
        
        \PY{k}{def} \PY{n+nf}{trapezoid\PYZus{}int}\PY{p}{(}\PY{n}{func}\PY{p}{,}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{,}\PY{n}{n}\PY{p}{)}\PY{p}{:}
            \PY{k}{if} \PY{n}{n}\PY{o}{\PYZlt{}}\PY{l+m+mi}{1}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{wrong number}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{,}\PY{n}{n}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{f\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vectorize}\PY{p}{(}\PY{n}{func}\PY{p}{)}\PY{p}{(}\PY{n}{x}\PY{p}{)}
            \PY{n}{delta} \PY{o}{=} \PY{p}{(}\PY{n}{b}\PY{o}{\PYZhy{}}\PY{n}{a}\PY{p}{)}\PY{o}{/}\PY{n}{n}
            \PY{k}{return} \PY{n}{delta}\PY{o}{/}\PY{l+m+mi}{2}\PY{o}{*}\PY{p}{(}\PY{n}{f\PYZus{}x}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{o}{+}\PY{n}{f\PYZus{}x}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{)}
        
        
        
        \PY{k}{def} \PY{n+nf}{simpson\PYZus{}int}\PY{p}{(}\PY{n}{func}\PY{p}{,}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{,}\PY{n}{n}\PY{p}{)}\PY{p}{:}
            \PY{k}{if} \PY{n}{n}\PY{o}{\PYZlt{}}\PY{l+m+mi}{1}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{wrong number}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{,}\PY{n}{n}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{f\PYZus{}x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vectorize}\PY{p}{(}\PY{n}{func}\PY{p}{)}\PY{p}{(}\PY{n}{x}\PY{p}{)}
            \PY{n}{delta} \PY{o}{=} \PY{p}{(}\PY{n}{b}\PY{o}{\PYZhy{}}\PY{n}{a}\PY{p}{)}\PY{o}{/}\PY{n}{n}
            \PY{k}{return} \PY{n}{delta}\PY{o}{/}\PY{l+m+mi}{3}\PY{o}{*}\PY{p}{(}\PY{n}{f\PYZus{}x}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{+}\PY{n}{f\PYZus{}x}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{+}\PY{l+m+mi}{4}\PY{o}{*}\PY{n}{f\PYZus{}x}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{o}{+}\PY{l+m+mi}{2}\PY{o}{*}\PY{n}{f\PYZus{}x}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{)}
        
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{trapezoid\PYZus{}int}\PY{p}{(}\PY{n}{func1}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{p}{(}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,}\PY{p}{(}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{5000000}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{simpson\PYZus{}int}\PY{p}{(}\PY{n}{func1}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{p}{(}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,}\PY{p}{(}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{50000000}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
3.141590805133173
3.1415907800862164

    \end{Verbatim}

    The results of using two methods are very close to the \(\pi\).

\subsection{}\label{section}

\textbf{\emph{Compute the truncation error for the numerical algorithms
implemented...}}

When fixing the number of sections and increase the length of interval:

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}34}]:} \PY{c+c1}{\PYZsh{} Define the truncaiton function that do the subtraction}
         \PY{k}{def} \PY{n+nf}{truncation\PYZus{}tra}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{N}\PY{p}{)}\PY{p}{:}
             \PY{k}{return} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{trapezoid\PYZus{}int}\PY{p}{(}\PY{n}{func1}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{n}{a}\PY{p}{,}\PY{n}{a}\PY{p}{,}\PY{n}{N}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{m}\PY{o}{.}\PY{n}{pi}\PY{p}{)}
         \PY{k}{def} \PY{n+nf}{truncation\PYZus{}sim}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{N}\PY{p}{)}\PY{p}{:}
             \PY{k}{return} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{simpson\PYZus{}int}\PY{p}{(}\PY{n}{func1}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{n}{a}\PY{p}{,}\PY{n}{a}\PY{p}{,}\PY{n}{N}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{m}\PY{o}{.}\PY{n}{pi}\PY{p}{)}
         \PY{k}{def} \PY{n+nf}{difference}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{N}\PY{p}{)}\PY{p}{:}
             \PY{k}{return} \PY{p}{(}\PY{n}{trapezoid\PYZus{}int}\PY{p}{(}\PY{n}{func1}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{n}{a}\PY{p}{,}\PY{n}{a}\PY{p}{,}\PY{n}{N}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{n}{simpson\PYZus{}int}\PY{p}{(}\PY{n}{func1}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{n}{a}\PY{p}{,}\PY{n}{a}\PY{p}{,}\PY{n}{N}\PY{p}{)}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} fix the number of section N}
         \PY{n}{N}\PY{o}{=}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{5}
         \PY{n}{a\PYZus{}list} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{)}
         \PY{n}{trunc1} \PY{o}{=} \PY{p}{[}\PY{n}{truncation\PYZus{}tra}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{N}\PY{p}{)} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{a\PYZus{}list}\PY{p}{]}
         \PY{n}{trunc2} \PY{o}{=} \PY{p}{[}\PY{n}{truncation\PYZus{}sim}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{N}\PY{p}{)} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{a\PYZus{}list}\PY{p}{]}
         \PY{n}{dif} \PY{o}{=} \PY{p}{[}\PY{n}{difference}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{N}\PY{p}{)} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{a\PYZus{}list}\PY{p}{]}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{a\PYZus{}list}\PY{p}{,}\PY{n}{trunc1}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Interval}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Absolute Value of Truncation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Truncation of Trapezoid Method}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}34}]:} Text(0.5,1,'Truncation of Trapezoid Method')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_59_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}35}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{a\PYZus{}list}\PY{p}{,}\PY{n}{trunc2}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Interval}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Absolute Value of Truncation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Truncation of Simpson Method}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}35}]:} Text(0.5,1,'Truncation of Simpson Method')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_60_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}36}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{a\PYZus{}list}\PY{p}{,}\PY{n}{dif}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Interval}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Difference}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Difference between Two Method}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}36}]:} Text(0.5,1,'Difference between Two Method')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_61_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    These two method seems both converge to their limitation quickly, while from the third plot which is the results' difference between these two methods, we can tell that the gap of two integrals can flucatuate dramatically during the interval width goes large.

When fixing the interval and add the amount of sections:

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}37}]:} \PY{c+c1}{\PYZsh{} fix the interval}
         \PY{n}{a} \PY{o}{=} \PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{5}
         \PY{n}{N\PYZus{}list}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{50}\PY{p}{)}
         \PY{n}{trunc3} \PY{o}{=} \PY{p}{[}\PY{n}{truncation\PYZus{}tra}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{n}\PY{p}{)} \PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n}{N\PYZus{}list}\PY{p}{]}
         \PY{n}{trunc4} \PY{o}{=} \PY{p}{[}\PY{n}{truncation\PYZus{}sim}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{n}\PY{p}{)} \PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n}{N\PYZus{}list}\PY{p}{]}
         \PY{n}{dif2} \PY{o}{=} \PY{p}{[}\PY{n}{difference}\PY{p}{(}\PY{n}{a}\PY{p}{,}\PY{n}{n}\PY{p}{)} \PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n}{N\PYZus{}list}\PY{p}{]}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{N\PYZus{}list}\PY{p}{,}\PY{n}{trunc3}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sections}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Absolute Value of Truncation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Truncation of Trapezoid Method}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}37}]:} Text(0.5,1,'Truncation of Trapezoid Method')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_63_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}38}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{N\PYZus{}list}\PY{p}{,}\PY{n}{trunc4}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sections}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Absolute Value of Truncation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Truncation of Simpson Method}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}38}]:} Text(0.5,1,'Truncation of Simpson Method')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_64_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}39}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{N\PYZus{}list}\PY{p}{,}\PY{n}{dif2}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sections}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Difference}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Difference between Two Method}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}39}]:} Text(0.5,1,'Difference between Two Method')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_65_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    At this time, we fix the length of the interval that we integral and try
to increase the number of sections. We can see that the simpson method,
compared to the trapezoid method, is much more fluctruated when it
approaching to the limitation. Howevr this time, the gap between this
two methods are quickly going to 0 when we adding more sections into the
integral.

\subsection{}\label{section}

\textbf{\emph{Thus, to ensure the convergence of the numerical
algorithms we pick a small tolerance value ...}}

Here we define a funciton to get the Intergral of a given funciton, and
use the defination of the tolerence to be the guard of the loop.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}50}]:} \PY{k}{def} \PY{n+nf}{Intergral}\PY{p}{(}\PY{n}{func}\PY{p}{,} \PY{n}{method}\PY{p}{,} \PY{n}{a}\PY{p}{,} \PY{n}{b}\PY{p}{,} \PY{n}{tolerance}\PY{p}{)}\PY{p}{:}  
             \PY{n}{n}\PY{o}{=}\PY{l+m+mi}{1}
             \PY{n}{I\PYZus{}last} \PY{o}{=} \PY{l+m+mi}{0}
             \PY{n}{I\PYZus{}now} \PY{o}{=} \PY{n}{method}\PY{p}{(}\PY{n}{func}\PY{p}{,}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{,}\PY{n}{n}\PY{p}{)}
             \PY{k}{while} \PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{I\PYZus{}now}\PY{o}{\PYZhy{}}\PY{n}{I\PYZus{}last}\PY{p}{)}\PY{o}{\PYZgt{}}\PY{n}{tolerance}\PY{p}{)}\PY{p}{:}   
                 \PY{n}{n}\PY{o}{=}\PY{n}{n}\PY{o}{+}\PY{l+m+mi}{1}
                 \PY{n}{I\PYZus{}last} \PY{o}{=} \PY{n}{I\PYZus{}now}
                 \PY{n}{I\PYZus{}now} \PY{o}{=} \PY{n}{method}\PY{p}{(}\PY{n}{func}\PY{p}{,}\PY{n}{a}\PY{p}{,}\PY{n}{b}\PY{p}{,}\PY{n}{n}\PY{p}{)}
             \PY{k}{return} \PY{n}{I\PYZus{}now}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ steps}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{n}
         \PY{n}{result1}\PY{p}{,}\PY{n}{n1} \PY{o}{=} \PY{n}{Intergral}\PY{p}{(}\PY{n}{func1}\PY{p}{,}\PY{n}{trapezoid\PYZus{}int}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{p}{(}\PY{l+m+mi}{30000}\PY{p}{)}\PY{p}{,}\PY{p}{(}\PY{l+m+mi}{30000}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{p}{)}
         \PY{n}{result2}\PY{p}{,}\PY{n}{n2} \PY{o}{=} \PY{n}{Intergral}\PY{p}{(}\PY{n}{func1}\PY{p}{,}\PY{n}{simpson\PYZus{}int}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{p}{(}\PY{l+m+mi}{30000}\PY{p}{)}\PY{p}{,}\PY{p}{(}\PY{l+m+mi}{30000}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{n}{result1}\PY{p}{,}\PY{n}{n1}\PY{p}{,}\PY{n}{result2}\PY{p}{,}\PY{n}{n2}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
3.135482924547999 9611 steps 3.141626510960827 21103 steps

    \end{Verbatim}

    The trapezoid method can meet the condition in much less steps
(9611\textless{}21103) however the result is not quite near to the real
\(\pi\). On the other hand, the simpson method although takes more
steps, it can get to the final result in a more higher accuracy. The
reason may be the defination of tolerence. The first method may not
fluctruate during the converging process which leads to the fast speed
to satisify this specific condition easily but still far away to its
real limitation.

\subsection{}\label{section}

\textbf{\emph{Intergral an arbitrary funciton}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}51}]:} \PY{k}{def} \PY{n+nf}{g\PYZus{}x}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{p}{:}
             \PY{k}{return} \PY{l+m+mi}{1}\PY{o}{+}\PY{n}{m}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{x}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{n}{m}\PY{o}{.}\PY{n}{cos}\PY{p}{(}\PY{l+m+mi}{8}\PY{o}{*}\PY{n}{x}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{l+m+mi}{2}\PY{o}{/}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{Intergral}\PY{p}{(}\PY{n}{g\PYZus{}x}\PY{p}{,}\PY{n}{simpson\PYZus{}int}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{o}{\PYZhy{}}\PY{l+m+mi}{4}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}51}]:} (1.9586979912115654, '6789 steps')
\end{Verbatim}
            
    It takes 6789 steps to get the final answer which is 1.9587.


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
